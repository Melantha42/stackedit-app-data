






# **第三章：存储系统 - 知识框架总览**

存储系统的核心目标是：**以尽可能接近高速缓存（Cache）的速度，提供尽可能接近外部存储器（硬盘）的巨大容量和低廉价格。** 其基本结构是“**Cache-主存-辅存**”三级结构。

---

### **一、 存储器概述（基础概念）**

#### **1. 分类（选择题高频考点）**
*   **按层次分类**：
    *   **Cache**：高速缓冲存储器，速度最快，容量最小，CPU直接访问。
    *   **主存**：内存，速度与容量介于Cache和辅存之间。
    *   **辅存**：磁盘、SSD等，速度慢，容量巨大，用于持久化存储。
*   **按存取方式分类**：
    *   **RAM**: 随机存取存储器，断电易失。包括SRAM（用作Cache）和DRAM（用作主存）。
    *   **ROM**: 只读存储器，断电非易失。如BIOS芯片。
    *   **SAM**: 顺序存取存储器，如磁带。
    *   **DAM**: 直接存取存储器，如磁盘。

**难点与易错点**：
*   准确区分**SRAM**和**DRAM**的特性差异（如下表）。
*   理解“随机存取”的含义：**存取时间与物理位置无关**。磁盘是直接存取，不是随机存取。

| 特性 | SRAM | DRAM |
| :--- | :--- | :--- |
| **存储原理** | 触发器 | 栅极电容 |
| **集成度** | 低 | 高 |
| **速度** | **快** | 慢 |
| **功耗** | 大 | 小 |
| **成本** | 高 | 低 |
| **刷新** | 无需刷新 | **需要定期刷新** |
| **用途** | **高速缓存(Cache)** | **主存** |

---

### **二、 主存储器（内存）**

#### **1. 主存的基本组成**
*   **存储体**：存储单元的集合。
*   **MAR**：存储器地址寄存器，位数对应存储单元数量（如MAR为10位，则有2¹⁰个单元）。
*   **MDR**：存储器数据寄存器，位数与存储字长相等（如MDR为16位，则字长为16位）。
*   **读写电路**、**控制逻辑**等。

#### **2. 存储器的扩展（重点计算/设计题）**
由于单片存储芯片容量有限，需要进行位扩展和字扩展来满足系统需求。
*   **位扩展**：增加存储字长。**地址线、控制线并联，数据线分开**。
    *   例如：用2个8K×4位的芯片，组成一个8K×8位的存储器。
*   **字扩展**：增加存储字数。**数据线、控制线并联，地址线通过译码器连接**。
    *   例如：用2个8K×8位的芯片，组成一个16K×8位的存储器。
*   **字位同时扩展**：两者结合。

**难点与易错点**：
*   **画连接图**：必须掌握CPU地址线、数据线、读写控制线如何与扩展后的存储器连接。
*   **地址分配**：给定芯片和地址范围，能计算出每个芯片的地址空间，以及**片选信号**的逻辑表达式。这是大题的核心。

---

### **三、 高速缓存（Cache）- 本章重中之重**

Cache的核心问题是：**如何将主存地址映射到Cache地址？**

#### **1. Cache的基本原理与性能**
*   **局部性原理**：时间局部性 + 空间局部性。这是Cache工作的理论基础。
*   **命中率H**：CPU要访问的信息在Cache中的比率。
*   **平均访问时间**：`Tₐ = H * T꜀ + (1-H) * Tₘ`
    *   `T꜀`：Cache访问时间
    *   `Tₘ`：主存访问时间（包含替换Cache块和将数据读入CPU的时间）
*   **效率**：`e = T꜀ / Tₐ`

#### **2. 地址映射方式（核心考点，必考）**
主存地址被划分为：**标记(Tag)** + **索引(Index)** + **块内地址(Offset)**
*   **直接相联映射**
    *   **规则**：主存中的每一块只能被映射到Cache中**唯一的一个特定行**。
    *   **地址结构**：`主存字块标记` + `Cache行号` + `块内地址`
    *   **优点**：硬件简单，成本低。
    *   **缺点**：冲突概率高，Cache利用率低。
*   **全相联映射**
    *   **规则**：主存中的每一块可以被映射到Cache中的**任意一行**。
    *   **地址结构**：`主存字块标记` + `块内地址`
    *   **优点**：冲突概率最低，空间利用率高。
    *   **缺点**：比较器电路复杂，速度慢，成本高。
*   **组相联映射（最常用）**
    *   **规则**：是直接映射和全相联的折中。将Cache分为若干组，每组内有若干行。主存块可以映射到**特定组的任意一行**。
    *   **地址结构**：`主存字块标记` + `组地址` + `块内地址`
    *   **n路组相联**：每组有n个Cache行。

**难点与易错点**：
*   **给定Cache容量、主存容量、块大小、映射方式，计算地址各部分的位数**。这是必考题型。
    *   `块内地址位数` = log₂(块大小/字节)
    *   `Cache索引/index位数`：
        *   直接映射：log₂(Cache行数)
        *   组相联映射：log₂(组数)
    *   `标记/tag位数` = 主存地址总位数 - index位数 - 块内地址位数

#### **3. Cache替换算法（当Cache满时，替换哪一行？）**
*   **随机算法**：简单，但命中率低。
*   **先进先出**：先调入的块先被替换。可能淘汰掉常用的块。
*   **近期最少使用(LRU)**：**最常用、效果最好**。替换最久未被访问的块。实现成本较高。
*   **最不经常使用**：替换访问次数最少的块。

#### **4. Cache写策略（保证Cache与主存数据一致性）**
*   **写命中**
    *   **写直达**：同时写入Cache和主存。简单，但总线 traffic大，速度慢。
    *   **写回法**：只修改Cache块，当该块被替换时才写回主存。需要在Cache行中增加一个**脏位**。速度快，但控制复杂。
*   **写不命中**
    *   **写分配法**：通常与**写回法**搭配。将要写的地址对应的主存块调入Cache，然后在Cache中修改。
    *   **非写分配法**：通常与**写直达法**搭配。直接写入主存，不调入Cache。

---

### **四、 虚拟存储器（与操作系统深度交叉）**

虚拟存储器的核心思想是：**将主存和辅存统一管理，对程序员透明，提供一个比实际主存大得多的编程空间。**

#### **1. 页式虚拟存储器（最重要）**
*   **基本概念**：虚拟（程序）空间和主存空间都划分为固定大小的页。
*   **页表**：实现虚页号到实页号（物理页框号）的映射。
    *   **页表项**：包含**有效位（存在位）**、**物理页框号**、**脏位**、**访问位**等。
*   **地址变换**：
    1.  CPU发出虚拟地址：`虚页号` + `页内地址`
    2.  用`虚页号`作为索引查询页表。
    3.  若有效位为1（命中），则将`物理页框号`与`页内地址`拼接，得到物理地址。
    4.  若有效位为0（缺页），则触发**缺页中断**，由操作系统将所需页面从磁盘调入主存，并更新页表。

#### **2. TLB（快表）- 加速地址变换**
*   **问题**：页表存放在主存中，每次访存需要先访问一次主存查页表，再访问一次主存取数据，速度减半。
*   **解决方案**：使用一个高速、小容量的Cache来存放最近常用的页表项，这就是TLB。
*   **工作流程**：虚拟地址先送TLB，若TLB命中，则直接得到物理页框号；若未命中，才去主存查慢表，并更新TLB。

**难点与易错点**：
*   **带TLB的访存有效时间计算**：
    *   设TLB命中率为H，TLB访问时间为Tₜ，主存访问时间为Tₘ。
    *   **有效时间** = H * (Tₜ + Tₘ) + (1-H) * (Tₜ + 2*Tₘ)
    *   `(1-H) * (Tₜ + 2*Tₘ)` 的解释：TLB未命中时，需要先访问主存取页表（第一次Tₘ），再访问主存取数据（第二次Tₘ）。

#### **3. 页面替换算法**
与Cache替换算法类似，但发生在主存-辅存层面。常见算法有：OPT、FIFO、LRU、CLOCK算法。LRU及其近似算法最常用。

---

### **总结：重难点与备考策略**

1.  **必考计算题**：
    *   存储器扩展（字位扩展、地址分配）。
    *   Cache地址映射（计算Tag/Index/Offset位数，画地址结构图）。
    *   带有TLB/ Cache的**平均访问时间计算**。

2.  **核心理解与辨析**：
    *   **SRAM vs DRAM**。
    *   **三种Cache映射方式**的优缺点对比。
    *   **Cache写策略**（写直达 vs 写回，写分配 vs 非写分配）及其组合。
    *   **虚拟存储器的目的和工作流程**。
    *   **TLB、Cache、Page（页）三者的关系与区别**（非常重要！）。

3.  **综合应用题**：
    *   题目可能将**Cache映射**和**虚拟存储**结合起来，给出一个完整的访存流程，让你分析某次访存是否在Cache/TLB中命中。这需要你清晰地画出从虚拟地址到物理地址，再到Cache地址的完整变换路径。

**备考建议**：反复练习历年真题中关于存储系统的所有题目，尤其是综合应用题。通过做题来巩固和串联这些知识点，形成完整的知识网络。这一章学透了，组成原理就拿下了一半。
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTU5ODYzMzk0OF19
-->